var comtab=function(n){if(!n)throw new Error("[comtab]: comtab.js require jquery.js");if(!n.ui)throw new Error("[comtab]: comTab.js require jquery-ui.js");var i=function(e){var t,a=e+"-pane",e=e+"-tab",n=d({PANE:a,PANE_HANDLE:a+"_handle",TAB:e,TAB_HEADER:e+"_header",TAB_CONTENT:e+"_content",TAB_BTN:e+"_btn"});for(t in n)n[t+"_ACTIVE"]=n[t]+"-active";return n}("comtab"),r=n("body"),o=null;function s(e,t){this.tabs=e,this._normalizeOptions(t),this._init()}function t(e,t,a){var n=_();return t.addClass(i.TAB_CONTENT).data("tab-id",n),e.addClass(i.TAB_BTN).data("tab-id",n),d({id:n,btn:e,content:t,_actived:!!a})}function d(e){var t={};if(e)for(var a in e)e.hasOwnProperty(a)&&(t[a]={value:e[a],writable:!0,configurable:!0,enumerable:!0});return Object.create(null,t)}function p(e,t){return e>=t[0]&&e<=t[1]}r.droppable({addClasses:!1,drop:function(e,t){o.type===i.TAB_BTN&&(b(),setTimeout(function(){s.createPaneByDomMap(o.pane._tplPaneMap,[o.tab._tpl]).setPosition(t.offset).mount(),o.tab._tpl.btn.data("tab-id",o.tab._tpl.id),o.tab._tpl.content.data("tab-id",o.tab._tpl.id)}))}}),s.prototype={mount:function(){return r.append(this._pane),this},removeTab:function(e){this.tabs.splice(this.tabs.indexOf(e),1),e.content.remove(),e.btn.remove()},addTab:function(e){this.tabs.push(e),this._tabHeader.append(e.btn),this._pane.append(e.content)},setPosition:function(e){return this._pane.css({position:"absolute",left:e.left+"px",top:e.top+"px"}),this},setRestrictSize:function(a){var n=this;["minWidth","minHeight","maxWidth","maxHeight"].forEach(function(e){var t="_"+e;n._resizable.resizable("option",e,n[t]=a[e]||n[t])})},setSize:function(e,t){return this._pane.css({width:e,height:t}),this},refreshZIndexCSS:function(){this._pane.css("z-index",this.zIndex)},_init:function(){var t=this,e=this._createPaneDomMap(),a=null;this._pane=e.pane,this._paneHandle=e.paneHandle,this._tabHeader=e.tabHeader,this.tabs.forEach(function(e){t._appendTab(e),t._initTabEvent(e),a&&e.actived?t._deactiveTab(e):e._actived&&t._activeTab(a=e)}),this.tabs.length<2&&this.tabs[0]._draggable.draggable("disable"),a||this._activeTab(a=this.tabs[0]),this._initPaneEvent(),this._initRestrictSize(),this._mapDom(),this.refreshZIndexCSS()},_activeTab:function(e){e.actived=!0,e.btn.addClass(i.TAB_BTN_ACTIVE),e.content.addClass(i.TAB_CONTENT_ACTIVE)},_deactiveTab:function(e){e.actived=!1,e.btn.removeClass(i.TAB_BTN_ACTIVE),e.content.removeClass(i.TAB_CONTENT_ACTIVE)},_initRestrictSize:function(){this.setRestrictSize(this._options)},_mapDom:function(){this._pane.data("pane-id",this.id=c.addPane(this))},_concatPane:function(e){var t=this;c.removePane(e.id),this.tabs.forEach(function(e){e.actived&&t._deactiveTab(e)}),this.tabs.length<2&&this.tabs[0]._draggable.draggable("enable"),e.tabs.forEach(function(e){t.addTab(e),e._draggable.draggable("destroy"),t._initTabEvent(e)}),e._pane.remove()},_initTabEvent:function(e){var t=this;e._draggable=e.btn.draggable({appendTo:r,addClasses:!1,helper:function(){return e._tpl=t._cloneTab(e),t._tplPaneMap=t._clonePaneDomMap(e._tpl),t._activeTab(e._tpl),o=d({pane:t,tab:e,type:i.TAB_BTN}),t._tplPaneMap.pane},drag:function(e){l(e)}})},_initPaneEvent:function(){var a=this;this._draggable=this._pane.draggable({appendTo:r,handle:this._paneHandle,addClasses:!1,start:function(){o=d({type:i.PANE,pane:a})},drag:function(e){l(e)}}),this._resizable=this._pane.resizable({addClasses:!1,containment:r,handles:"n, e, s, w, ne, se, sw, nw"}),this._droppable=this._pane.droppable({greedy:!0,addClasses:!1,tolerance:"pointer",over:function(){o.overedPane=a},out:function(){o.overedPane=null,h(a)},drop:function(){var e;h(a),o.type===i.PANE?a._concatPane(o.pane):o.type===i.TAB_BTN&&o.pane!==a&&(e=s.createPaneByDomMap(o.pane._tplPaneMap,[o.tab._tpl]),a._concatPane(e),b())}}),this._listeners={paneSelect:function(e){c.selectPane(a);var t=n(e.target).data("tab-id");!t||(e=a.tabs.filter(function(e){return e.id===t})[0])&&!e.actived&&(a.tabs.forEach(function(e){e.actived&&a._deactiveTab(e)}),a._activeTab(e))}},this._pane.on("mousedown",this._listeners.paneSelect)},_clonePaneDomMap:function(e){var t=this._createPaneDomMap();return this._appendTab.call({_pane:t.pane,_paneHandle:t.paneHandle,_tabHeader:t.tabHeader},e),t},_cloneTab:function(e){return t(e.btn.clone(),e.content.clone())},_appendTab:function(e){this._pane.append(e.content),this._tabHeader.append(e.btn)},_normalizeOptions:function(e){e=e||{};var t=d({minWidth:100,minHeight:60});this._options=Object.assign(t,e)},_createPaneDomMap:function(){var e=n('<div class="'+i.PANE+'"></div>'),t=n('<div class="'+i.PANE_HANDLE+'"></div>'),a=n('<div class="'+i.TAB_HEADER+'"></div>');return e.append(t).append(a),d({pane:e,paneHandle:t,tabHeader:a})}},s.createPaneByDomMap=function(e,t){var a=new s._Fn;return a._createPaneDomMap=function(){return e},s.call(a,t),delete a._createPaneDomMap,a},(s._Fn=function(){}).prototype=s.prototype,s._Fn.constructor=s;var c={paneMap:d(null),paneCount:0,topZIndex:0,addPane:function(e){var t=_();return this.paneMap[t]=e,this.topZIndex=e.zIndex=this.paneCount++,t},removePane:function(e){this.topZIndex===this.paneMap[e].zIndex&&this.topZIndex--,delete this.paneMap[e],this.paneCount--},selectPane:function(e){if(e.zIndex!==this.topZIndex){for(var t in this.paneMap){var a=this.paneMap[t];a.zIndex>e.zIndex&&(a.zIndex--,a.refreshZIndexCSS())}e.zIndex=this.topZIndex,e.refreshZIndexCSS()}}};function _(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];for(32,e=0;e<32;e++)a[e]=t[0|16*Math.random()];return a.join("")}function b(){o.pane.removeTab(o.tab),o.pane.tabs.length<2&&o.pane.tabs[0]._draggable.draggable("disable"),o.tab.actived&&o.pane._activeTab(o.pane.tabs[0])}function l(e){var t,a=o.overedPane;a&&(t=a._tabHeader,e={x:e.pageX,y:e.pageY},a=a._pane.offset(),e.x-=a.left,e.y-=a.top,a=e,(e=t.position()).width=t.outerWidth(),e.height=t.outerHeight(),e=e,a=p((a=a).x,[e.left,e.left+e.width])&&p(a.y,[e.top,e.top+e.height]),e=o.inOveredTabHeader^a,o.inOveredTabHeader=a,e&&(a?t.addClass(i.TAB_HEADER_ACTIVE):t.removeClass(i.TAB_HEADER_ACTIVE)))}function h(e){o.inOveredTabHeader&&(e._tabHeader.removeClass(i.TAB_HEADER_ACTIVE),o.inOveredTabHeader=!1)}return{createPane:function(e,t){return new s(e,t)},createTab:t}}(window.$||window.jQurey);