!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).comtab=e(t._)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=e(t);class n{constructor(t,e){this.link(t,e)}dispatch(...t){const e=t[0],s=this[`dispatch${e.getTypeName()}`];Reflect.apply(s,this,t),this.propagation(e,t)}link(t,e){t.bind(this,e),e.bind(this,t),this._model=t,this._view=e}setParent(t){this._parent=t}propagation(t,e){this._parent&&t.isPropagation()&&(t.progagation(),Reflect.apply(this._parent.dispatch,this._parent,[t,...e]))}}class i extends n{dispatchModel(t,e){"activateTab"===e&&(this._model.getState().tabs.forEach((t=>t._model.activate())),t.stopPropagation())}dispatchView(t,...e){throw new Error("Method not implemented.")}}function a(...t){return s.default.merge.apply(null,t)}function o(t=""){var e,s=16,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];for(s=s||n.length,e=0;e<32;e++)i[e]=n[0|Math.random()*s];return t+i.join("")}function r(t,e="div"){return $(`<${e} class="${t}">`)}class l extends class{constructor(t,e=!0){this.type=t+"Event",this._bubble=e,this._isBubble=!1}isType(t){return this.getTypeName()===t}getTypeName(){return t=this.type,e=0,s=-5,t.substring(e,s<0?t.length+s:s);var t,e,s}stopPropagation(){this._bubble=!1}isPropagation(){return this._bubble}progagation(){this._isBubble=!0}isBubble(){return this._isBubble}}{constructor(t){super("Model",t)}}function c(t,e,s){Reflect.apply(t,e,s)}function h(t,e){this._controller=t,this instanceof d?this.linkView(e):this.linkModel(e)}class d{constructor(){this._data=Object.create(null),this.bind=h}linkView(t){this._view=t}}d.prototype.notify=function(...t){c(this._controller.dispatch,this._controller,t)};class _ extends d{constructor(t){super(),this._state={id:o("panel"),position:{left:0,top:0},zIndex:0,actived:!1,tabs:[]},a(this._state,t)}activate(){this._state.actived=!0,this.notify(new l,"activateTab")}deactivate(){this._state.actived=!1,this.notify(new l,"deactivateTab")}getState(){return this._state}}class p{constructor(){this.bind=h}linkModel(t){this._model=t}}p.prototype.notify=function(...t){c(this._controller.dispatch,this._controller,t)};var u=function(t){var e=t+"-stage",s=t+"-panel",n=s+"-dropready",i=s+"-group",a=i+"_column",o=t+"-tab",r=o+"_header",l=t+"-absorb",c=l+"-vertical",h=l+"-horizontal",d=function(t){var e={};if(t)for(var s in t)t.hasOwnProperty&&!t.hasOwnProperty(s)||(e[s]={value:t[s],writable:!0,configurable:!0,enumerable:!0});return Object.create(null,e)}({PANE:s,PANE_HANDLE:s+"_handle",PANE_GROUP:i,TAB:o,TAB_HEADER:r,TAB_CONTENT:o+"_content",TAB_BTN:o+"_btn",ABSORB:l,CONTAINER:t+"-container"});for(var _ in d)d[_+"_ACTIVE"]=d[_]+"-active";return d.ABSORB_VERTICAL=c,d.ABSORB_HORIZONTAL=h,["top","right","left","bottom"].forEach((function(t){d["ABSORB_"+t.toUpperCase()]=l+"_"+t})),d.PANE_DROP_READY=n,d.PANE_GROUP_COLUMN=a,d.TAB_HEADER_DROP=r+"_droppable",d.STAGE=e,d}("comtab");class b extends p{create(t){this._createElements(),this._$wrapper.append(this._$panelHandle).append(this._$header),t.forEach((t=>{const{btn:e,content:s}=t.getView().getElements();this._$wrapper.append(s),this._$header.append(e)}))}_createElements(){this._$wrapper=r(u.PANE),this._$panelHandle=r(u.PANE_HANDLE),this._$header=r(u.TAB_HEADER)}getElements(){return{wrapper:this._$wrapper,handle:this._$panelHandle,header:this._$header}}}class f{constructor(t){this._model=new _(t),this._view=new b,this._controller=new i(this._model,this._view),this._init()}_init(){const t=this._model.getState();this._view.create(t.tabs),t.tabs.forEach((t=>t._controller.setParent(this._controller)))}}class v extends n{dispatchModel(t,e){}dispatchView(t,e){}}class w extends d{constructor(t){super(),this._state={panels:[],groups:[],stage:"body"},a(this._state,t)}getState(){return this._state}addPanel(t){this._state.panels.push(t),this.notify(new l(!1),"addPanel",t)}deletePanel(t){!function(...t){s.default.pull.apply(null,t)}(this._state.panels,t),this.notify(new l(!1),"deletePanel",t)}}class T extends p{create(t){this._$wrapper=$(t.stage).addClass(u.STAGE),t.panels.forEach((t=>this.addPanel(t)))}addPanel(t){this._$wrapper.append(t._view.getElements().wrapper)}deletePanel(t){}}class g{constructor(t){this._model=new w(t),this._view=new T,this._controller=new v(this._model,this._view),this._init()}addPanel(t){this._model.addPanel(t)}deletePanel(t){this._model.deletePanel(t)}_init(){const t=this._model.getState();this._view.create(t),t.panels.forEach((t=>t._controller.setParent(this._controller)))}}class E extends n{dispatchModel(t,...e){"activateTab"===e[0]&&this._view.activate()}dispatchView(t,...e){throw new Error("Method not implemented.")}}class m extends d{constructor(t){super(),this._state={btnText:"btn",content:"<p>This is content.<p>",actived:!1},a(this._state,t)}activate(){this._state.actived=!0,this.notify(new l,"activateTab")}deactivate(){this._state.actived=!1,this.notify(new l,"deactivateTab")}getState(){return this._state}}class A extends p{create(t){this._$btn=r(u.TAB_BTN).text(t.btnText),this._$content=$(t.content).addClass(u.TAB_CONTENT),t.actived&&this.activate(),this.bindEvents()}bindEvents(){this._$btn.on("click",(()=>this._model.activate()))}activate(){this._$content.addClass(u.TAB_CONTENT_ACTIVE),this._$btn.addClass(u.TAB_BTN_ACTIVE)}deactive(){this._$content.removeClass(u.TAB_CONTENT_ACTIVE),this._$btn.removeClass(u.TAB_BTN_ACTIVE)}getElements(){return{btn:this._$btn,content:this._$content}}}class P{constructor(t){this._model=new m(t),this._view=new A,this._controller=new E(this._model,this._view),this._init()}_init(){const t=this._model.getState();this._view.create(t)}getView(){return this._view}getModel(){return this._model}}
/**
   * A library for creating panels like PhotoShop.
   * 
   * Support ES5 browsers and above (ie10+, edge12+, chrome23+, safari6+, opeara15+)
   * For more compatibility details, see https://www.caniuse.com/es5
   * 
   * @author cary-mao
   * @license MIT
   * @copyright cary-mao 2021
   * @email 773099867@qq.com
   */
const y=function(t){const e={stage:(t=function(t={}){return a({panels:[],groups:[],stage:"body"},t)}(t)).stage};e.panels=t.panels.map((t=>{const e=(n=t,s.default.cloneDeep(n));var n;if(t.tabs){const s=t.tabs.filter((t=>t.actived));if(s.length)for(let t=1,e=s.length;t<e;t++)s[t].actived=!1;e.tabs=t.tabs.map((t=>new P(t)))}return new f(e)}));return new g(e)};return y.Panel=f,y.PanelStage=g,y.PanelGroup=class{},y}));
