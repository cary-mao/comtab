var __defProp=Object.defineProperty,__hasOwnProp=Object.prototype.hasOwnProperty,__getOwnPropSymbols=Object.getOwnPropertySymbols,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(t,e,s)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,__assign=(t,e)=>{for(var s in e||(e={}))__hasOwnProp.call(e,s)&&__defNormalProp(t,s,e[s]);if(__getOwnPropSymbols)for(var s of __getOwnPropSymbols(e))__propIsEnum.call(e,s)&&__defNormalProp(t,s,e[s]);return t};!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).comtab=e(t._)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=e(t);function a(...t){return s.default.merge.apply(null,t)}function i(t){return s.default.zip.apply(null,t)}function n(...t){return s.default.pull.apply(null,t)}function o(t){return s.default.cloneDeep(t)}function l(t){return void 0!==t}function r(t){const e={};if(t)for(const s in t)t.hasOwnProperty&&!t.hasOwnProperty(s)||(e[s]={value:t[s],writable:!0,configurable:!0,enumerable:!0});return Object.create(null,e)}function h(t=""){let e=16;const s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),a=[];let i;for(e=e||s.length,i=0;i<32;i++)a[i]=s[0|Math.random()*e];return t+a.join("")}function d(t,e="div"){return $(`<${e} class="${t}">`)}const p={task:"init",type:"init",debugger:"development"==={}.NODE},c=new class{constructor(){this.tasks=[],this.currIdx=-1,this.immediate=!1}record(t,e){this.currTask===t?this.tasks[this.tasks.length-1].logs.push(e):(this.immediate&&this.currIdx>=0&&this.log(this.currIdx),this.currTask=t,this.tasks.push({name:t,logs:[e]}),this.currIdx++)}log(t){this.tasks[t].logs.forEach((t=>Reflect.apply(console.log,console,t)))}scopeLog(t=0,e=this.tasks.length){for(;t<e;)console.log(`%c task ${t}: %c ${this.tasks[t].name} `,"color: red; weight: bold","color: blue"),console.log("%c -------------------------- ","color: orange"),this.log(t),console.log("%c -------------------------- ","color: orange"),console.log("\n\n"),t++}};var _=new class extends class{constructor(t){this._value=t,this._initValue=o(t)}set value(t){this._value=t}get value(){return this._value}reset(){this._value=o(this._initValue)}}{setTask(t){this.value.task=t}resetWithoutTask(){const t=this.value.task;this.reset(),this.setTask(t)}}(p);class g{constructor(t,e){this.link(t,e)}dispatch(...t){c.record(_.value.task,[`${t[1]}(${this.constructor.name}): `,t.slice(2)]);const e=t[0],s=this[`dispatch${e.getTypeName()}`];Reflect.apply(s,this,t),this.propagation(e,t.slice(1))}link(t,e){t.bind(this,e),e.bind(this,t),this._model=t,this._view=e}setParent(t){this._parent=t}getParent(){return this._parent}propagation(t,e){this._parent&&t.isPropagation()&&(t.progagation(),Reflect.apply(this._parent.dispatch,this._parent,[t,...e]))}}class u extends g{constructor(t,e,s){super(t,e),this.host=s}dispatchModel(t,e,s){if("setZIndex"===e)this._view.setZIndex(s);else if("deletePanel"===e){this._view.deletePanel(s);const t=this._model.getState();1===t.matrix.length&&1===t.matrix[0].length&&(this._view.freePanel(t.matrix[0][0]),this._parent.host.deleteGroup(this.host))}}dispatchView(t,...e){throw new Error("Method not implemented.")}}class v{constructor(t,e=!0){this.type=t+"Event",this._bubble=e,this._isBubble=!1}isType(t){return this.getTypeName()===t}getTypeName(){return t=this.type,e=0,s=-5,t.substring(e,s<0?t.length+s:s);var t,e,s}stopPropagation(){this._bubble=!1}isPropagation(){return this._bubble}progagation(){this._isBubble=!0}isBubble(){return this._isBubble}}class b extends v{constructor(t){super("Model",t)}}class m extends g{constructor(t,e,s){super(t,e),this.host=s}dispatchModel(t,e,s){"deactivateTab"!==e?"activateTab"!==e||this._parent?"toggleTabHandleEvent"===e&&(this._view.toggleTabHandleEvent(s),t.stopPropagation()):this._view.activate():this._view.deactivate()}dispatchView(t,...e){throw new Error("Method not implemented.")}}function w(t,e,s){Reflect.apply(t,e,s)}function E(t,e){this._controller=t,this instanceof P?this.linkView(e):this.linkModel(e)}class P{constructor(){this._data=Object.create(null),this.bind=E}linkView(t){this._view=t}}P.prototype.notify=function(...t){w(this._controller.dispatch,this._controller,t)};class f extends P{constructor(t,e){super(),this._state={btnText:"btn",content:"<p>This is content.<p>",actived:!1,_tabHandleEnabled:!1},a(this._state,t),this.host=e}toggleTabHandleEvent(t){this._state._tabHandleEnabled!==t&&(this._state._tabHandleEnabled=t,this.notify(new b(!1),"toggleTabHandleEvent",t))}activate(t=new b){this._state.actived||(this._state.actived=!0,this.notify(t,"activateTab",this))}deactivate(t=new b){this._state.actived=!1,this.notify(t,"deactivateTab")}getState(){return this._state}}var T=function(t){var e=t+"-stage",s=t+"-panel",a=s+"-dropready",i=s+"-group",n=i+"_column",o=t+"-tab",l=o+"_header",h=t+"-absorb",d=h+"-vertical",p=h+"-horizontal",c=r({PANE:s,PANE_HANDLE:s+"_handle",PANE_GROUP:i,TAB:o,TAB_HEADER:l,TAB_CONTENT:o+"_content",TAB_BTN:o+"_btn",ABSORB:h,CONTAINER:t+"-container"});for(var _ in c)c[_+"_ACTIVE"]=c[_]+"-active";return c.ABSORB_VERTICAL=d,c.ABSORB_HORIZONTAL=p,["top","right","left","bottom"].forEach((function(t){c["ABSORB_"+t.toUpperCase()]=h+"_"+t})),c.PANE_DROP_READY=a,c.PANE_GROUP_COLUMN=n,c.TAB_HEADER_DROP=l+"_droppable",c.STAGE=e,c}("comtab");class y{constructor(){this.bind=E}linkModel(t){this._model=t}}y.prototype.notify=function(...t){w(this._controller.dispatch,this._controller,t)};class x extends y{constructor(t){super(),this.events={},this.host=t}toggleTabHandleEvent(t){t?this._$btn.addClass(T.PANE_HANDLE):this._$btn.removeClass(T.PANE_HANDLE)}create(t){t=t||this._model.getState(),this._$btn=d(T.TAB_BTN).text(t.btnText),this._$content=$(t.content).addClass(T.TAB_CONTENT),t.actived&&this.activate(),t._tabHandleEnabled&&this.toggleTabHandleEvent(!0),this.bindEvents()}bindEvents(){this.events.btnClickFn=()=>{_.setTask("activateTab"),this._model.activate()},this._$btn.on("mousedown",this.events.btnClickFn),this.events.tabSplit=this._$btn.draggable({delay:200,helper:()=>{_.setTask("tmpPanelFromTabDrag");const t=N.copyPanelByTabs(this.host);return t._view.setZIndex(this.host.getPanelLayer().getTopZIndex()+1),_.value.panel=t,_.value.tab=this.host,_.value.type="tmpPanelFromTabDrag",t._view.getElements().wrapper}})}destoryEvents(){this._$btn.off("mousedown",this.events.btnClickFn),this.events.tabSplit.draggable("destroy")}toggleTabSplitEvent(t){t=l(t)?t:this.events.tabSplit.draggable("option","disabled"),this.events.tabSplit,this.events.tabSplit.draggable(t?"enable":"disable")}activate(){this._$content.addClass(T.TAB_CONTENT_ACTIVE),this._$btn.addClass(T.TAB_BTN_ACTIVE)}deactivate(){this._$content.removeClass(T.TAB_CONTENT_ACTIVE),this._$btn.removeClass(T.TAB_BTN_ACTIVE)}getElements(){return{btn:this._$btn,content:this._$content}}remove(){this._$btn.remove(),this._$content.remove()}}class S{constructor(t){this._model=new f(t,this),this._view=new x(this),this._controller=new m(this._model,this._view,this),this._init()}_init(){const t=this._model.getState();this._view.create(t)}getParent(){return this._controller.getParent().host}getPanelLayer(){let t=this._controller.getParent().getParent();return t instanceof u&&(t=t.getParent()),t.host.panelLayer}static copy(t){return new S(o(t._model.getState()))}}class A extends g{constructor(t,e,s){super(t,e),this.host=s}dispatchModel(t,e,s){"addPanel"===e?(this.host.panelLayer.add(s),s._controller.setParent(this),this._view.addPanel(s)):"deletePanel"===e?(this.host.panelLayer.remove(s),this._view.deletePanel(s)):"activatePanel"===e||"activateGroup"===e?this.host.panelLayer.activate(s):"deleteGroup"===e&&(this.host.panelLayer.remove(s),this._view.deleteGroup(s))}dispatchView(t,e,s){if("tmpPanelFromTabDrop"===e){const t=_.value.tab.getParent();t.deleteTab(_.value.tab),_.value.panel._view.create(),_.value.panel.setPosition(s.offset),t._view.refreshTabSplitEvent(),this._model.addPanel(_.value.panel)}else if("splitPanelFromGroupDrop"===e){const t=_.value.origin,e=_.value.panel,a=t.getParent();e._view.create(),e._model.setGroupIdxes(null),e._model.toggleClickActivateEnabled(!0),e._model.toggleDragEvent(!0),e._model.toggleHeaderSplitEnabled(!1),e._view.refreshTabSplitEvent(!0),a._model.deletePanel(t),e.setPosition(s.offset),this._model.addPanel(e)}}}class I extends g{constructor(t,e,s){super(t,e),this.host=s}dispatchModel(t,e,s){if("activateTab"===e)this._model.getState().tabs.forEach((t=>{const e=t._model,a=e.getState().actived;s===e?t._view.activate():a&&e.deactivate(new b(!1))})),t.stopPropagation();else if("deleteTab"===e){const e=s.tab;e._view.remove(),e._model.getState().actived&&this._model.getState().tabs[0]._model.activate(),t.stopPropagation()}else"setPanelPosition"===e?(this._view.setPosition(s),t.stopPropagation()):"toggleTabSplitEvent"===e?this._view.setTabSplitEvent(s):"togglePanelDragEvent"===e?this._view.setDragEvent(s):"toggleClickActivateEnabled"===e?this._view.setClickActivateEvent(s):"toggleHeaderSplitEnabled"===e?this._view.setHeaderSplitEvent(s):"setZIndex"===e?this._view.setZIndex(s):"addTabs"===e?(s.forEach((t=>{t._controller.setParent(this)})),this._view.addTabs(s),this._model.toggleTabSplitEvent(this._model.getState().tabs.length>1),t.stopPropagation()):"setHandleVisible"===e&&this._view.setHandleVisble(s)}dispatchView(t,e,s){if("panelDragStart"===e)_.value.panel=s;else if("insertPanelToTabHeader"===e){const e=_.value.panel;this._parent instanceof A?this._parent.host.deletePanel(e):this._parent instanceof u&&this._parent._parent.host.deletePanel(e),e.state.tabs.forEach((t=>{t._model.deactivate(new b(!1)),t._view.create()})),Reflect.apply(this._model.addTabs,this._model,e.state.tabs),t.stopPropagation()}else if("insertTmpPanelToTabHeader"===e){const e=_.value.tab.getParent();e.deleteTab(_.value.tab),_.value.panel._view.create(),_.value.panel.setPosition(s.offset),e._view.refreshTabSplitEvent(),_.value.panel.state.tabs.forEach((t=>{t._model.deactivate(new b(!1)),t._view.create()})),Reflect.apply(this._model.addTabs,this._model,_.value.panel.state.tabs),t.stopPropagation()}}getModel(){return this._model}}class k extends P{constructor(t,e){super(),this._state={id:h("panel"),position:{left:0,top:0},zIndex:0,actived:!1,tabs:[],handleVisible:!0,_tabSplitEnabled:!0,_dragEnabled:!0,_clickActivateEnabled:!0,_headerSplitEnabled:!1,width:200,height:200,groupIdxes:null},a(this._state,t),this.host=e}setGroupIdxes(t){this._state.groupIdxes=t}setHandleVisible(t){this._state.handleVisible=t,this.notify(new b(!1),"setHandleVisible",t)}setSize(t){this._view.setSize(t)}setZIndex(t){this._state.zIndex=t,this.notify(new b(!1),"setZIndex",t)}setPosition(t){a(this._state.position,t),this.notify(new b(!1),"setPanelPosition",this._state.position)}activate(){this._state.actived=!0,this.notify(new b,"activatePanel",this.host)}deactivate(){this._state.actived=!1,this.notify(new b,"deactivatePanel")}deleteTab(e){t.pull(this._state.tabs,e),this.notify(new b,"deleteTab",{tab:e})}addTabs(...t){this._state.tabs=this._state.tabs.concat(t),this.notify(new b(!1),"addTabs",t)}toggleTabSplitEvent(t){this._state._tabSplitEnabled=l(t)?t:!this._state._tabSplitEnabled,this.notify(new b(!1),"toggleTabSplitEvent",this._state._tabSplitEnabled)}toggleDragEvent(t){this._state._dragEnabled=l(t)?t:!this._state._dragEnabled,this.notify(new b(!1),"togglePanelDragEvent",this._state._dragEnabled)}toggleClickActivateEnabled(t){this._state._clickActivateEnabled=l(t)?t:!this._state._clickActivateEnabled,this.notify(new b(!1),"toggleClickActivateEnabled",this._state._clickActivateEnabled)}toggleHeaderSplitEnabled(t){this._state._headerSplitEnabled=l(t)?t:!this._state._headerSplitEnabled,this.notify(new b(!1),"toggleHeaderSplitEnabled",this._state._headerSplitEnabled)}getState(){return this._state}}class H extends v{constructor(t){super("View",t)}}class D extends y{constructor(t){super(),this.events={},this.host=t}setHeaderSplitEvent(t){this.events.headerSplit.draggable(t?"enable":"disable")}splitFromContainer(){}setHandleVisble(t){const e=t?"show":"hide";this._$panelHandle[e]()}setClickActivateEvent(t=!0){const e=t?"on":"off";this._$wrapper[e]("mousedown",this.events.clickActivateFn)}setDragEvent(t=!0){this.events.panelDrag.draggable(t?"enable":"disable")}setSize(t){this._$wrapper.css({width:t.width?t.width+"px":void 0,height:t.height?t.height+"px":void 0})}refreshTabSplitEvent(t=!1){const e=this._model.getState();e.tabs.length<=1&&(e._tabSplitEnabled||t)?this._model.toggleTabSplitEvent(!1):e.tabs.length>1&&(!e._tabSplitEnabled||t)&&this._model.toggleTabSplitEvent(!0)}addTabs(t){t.forEach((t=>{const{btn:e,content:s}=t._view.getElements();this._$header.append(e),this._$wrapper.append(s)}))}setZIndex(t){this._$wrapper.css("z-index",t)}setTabSplitEvent(t){this._model.getState().tabs.forEach((e=>{e._view.toggleTabSplitEvent(t),this.toggleDragPanelWithTabEvent(e,!t)}))}toggleDragPanelWithTabEvent(t,e){t._model.toggleTabHandleEvent(e)}setPosition(t){this._$wrapper.css({left:t.left+"px",top:t.top+"px"})}create(){const t=this._model.getState().tabs;this._createElements(),this._$wrapper.append(this._$panelHandle).append(this._$header),t.forEach((t=>{const{btn:e,content:s}=t._view.getElements();this._$wrapper.append(s),this._$header.append(e)})),this.bindEvents();this._model.getState()._headerSplitEnabled||this.setHeaderSplitEvent(!1)}bindEvents(){this.events.headerSplit=this._$header.draggable({cancel:"."+T.TAB_BTN,delay:300,helper:()=>{const t=N.copy(this.host);return t._model.setHandleVisible(!1),t._view.setZIndex(this.host.getPanelLayer().getTopZIndex()+1),_.setTask("splitPanelFromGroup"),_.value.type="splitPanelFromGroup",_.value.panel=t,_.value.origin=this.host,t._view.getElements().wrapper}}),this.events.clickActivateFn=()=>{_.setTask("activatePanel"),this._model.activate()},this._$wrapper.on("mousedown",this.events.clickActivateFn),this.events.panelDrag=this._$wrapper.draggable({handle:"."+T.PANE_HANDLE,start:()=>{_.setTask("panelDragStart"),_.value.type="panelDragging",this.notify(new H(!1),"panelDragStart",this.host)}}),this._$header.droppable({tolerance:"pointer",greedy:!0,accept:()=>["tmpPanelFromTabDrag","panelDragging"].some((t=>t===_.value.type)),drop:()=>{"tmpPanelFromTabDrag"!==_.value.type?(_.setTask("insertPanelToTabHeader"),this.notify(new H,"insertPanelToTabHeader",this.host)):this.notify(new H,"insertTmpPanelToTabHeader",this.host)}})}_createElements(){this._$wrapper=d(T.PANE),this._$panelHandle=d(T.PANE_HANDLE),this._$header=d(T.TAB_HEADER)}getElements(){return{wrapper:this._$wrapper,handle:this._$panelHandle,header:this._$header}}}class N{getPanelLayer(){let t=this._controller.getParent();return t instanceof u&&(t=t.getParent()),t.host.panelLayer}constructor(t){this._model=new k(t,this),this._view=new D(this),this._controller=new I(this._model,this._view,this),this._init()}getPosition(){return this._model.getState().position}get state(){return this._model.getState()}setZIndex(t){this._model.setZIndex(t)}setPosition(t){this._model.setPosition(t)}_init(){const t=this._model.getState();this._view.create(),this._view.setPosition(t.position),this._view.setSize({width:t.width,height:t.height}),t.tabs.forEach((t=>t._controller.setParent(this._controller))),this._view.refreshTabSplitEvent()}setSize(t){this._model.setSize(t)}deleteTab(t){this._model.deleteTab(t)}static copyPanelByTabs(...t){const e=t.map((t=>{const e=S.copy(t);return e._model.activate(new b(!1)),e}));return new N({tabs:e})}static copy(t){const e=t.state,s=e.tabs.map((t=>S.copy(t)));return new N(__assign(__assign({},o(e)),{tabs:s}))}get width(){return this._model.getState().width}get height(){return this._model.getState().height}getParent(){return this._controller.getParent().host}}class C extends P{constructor(t,e){super(),this._state={matrix:[],position:null,autoPos:!0,id:h("panelGroup"),zIndex:0},this.host=e,a(this._state,t)}setPosition(t,e=!0){this._state.position=t,e&&this.notify(new b(!1),"setPosition",t)}activate(){this.notify(new b,"activateGroup",this.host)}deletePanel(t){const e=this._state.matrix,[s,a]=t.state.groupIdxes;if(this._state.matrix[s][a]===t){const n=i(e);n[a].splice(s,1),0===n[a].length&&n.splice(a,1);const o=[];i(n).forEach(((t,e)=>{const s=t.filter((t=>!!t));s.length&&(o[e]=s)})),this._state.matrix=o,this.notify(new b(!1),"deletePanel",t)}}setZIndex(t){this._state.zIndex=t,this.notify(new b(!1),"setZIndex",t)}getState(){return this._state}}class O extends y{freePanel(t){t.setPosition(this._model.getState().position),this.host.getParent().addPanel(t),t._model.setGroupIdxes(null),t._model.toggleDragEvent(!0),t._model.toggleClickActivateEnabled(!0),t._model.toggleHeaderSplitEnabled(!1)}deletePanel(t){t._view.getElements().wrapper.remove(),this.restrictPanels(),this.refreshPosition()}constructor(t){super(),this.host=t}create(){const t=this._model.getState();this._$wrapper=d(T.PANE_GROUP),this.refreshPosition(),t.matrix.forEach((t=>t.forEach((t=>this.addPanel(t))))),this.restrictPanels(),this.bindEvents()}restrictPanels(){this._model.getState().matrix.forEach(((t,e)=>{t.forEach(((t,s)=>{t.state.groupIdxes?1===t.state.groupIdxes[0]&&t._model.setHandleVisible(!0):(t._model.toggleDragEvent(!1),t._model.toggleClickActivateEnabled(!1),t._model.toggleHeaderSplitEnabled(!0)),t._model.setGroupIdxes([e,s]),0!==e&&t._model.setHandleVisible(!1)}))}))}bindEvents(){this._$wrapper.on("mousedown",(()=>{_.setTask("activateGroup"),this._model.activate()})),this._$wrapper.draggable({handle:"."+T.PANE_HANDLE,start(){_.setTask("groupDragging"),_.value.type="groupDragging"},drag:(t,e)=>{this._model.setPosition(e.position,!1)}})}getElements(){return{wrapper:this._$wrapper}}setZIndex(t){this._$wrapper.css("z-index",t)}addPanel(t){this._$wrapper.append(t._view.getElements().wrapper)}refreshPosition(){const t=this._model.getState(),e=t.position?t.position:t.matrix[0][0].getPosition();if(this.setPosition(e),t.autoPos){const e=[],s=[0],a=[];for(let i=0,n=t.matrix.length;i<n;i++){const n=t.matrix[i];for(let o=0,l=n.length;o<l;o++){const l=n[o];e[i]||(e[i]=[]),e[i][o]={},0===i?(s[o+1]=s[o]+l.width,e[i][o].left=s[o]):e[i][o].width=t.matrix[0][o].width,a[o]||(a[o]=[0]),a[o][i+1]=a[o][i]+l.height,e[i][o].top=a[o][i]}}e.forEach(((e,s)=>{e.forEach(((e,a)=>{const i=t.matrix[s][a];i.setPosition(e),e.width&&i.setSize(e)}))}))}}setPosition(t){D.prototype.setPosition.call(this,t)}}class B{constructor(t){this._model=new C(t,this),this._view=new O(this),this._controller=new u(this._model,this._view,this),this._init()}_init(){const t=this._model.getState();this._view.create(),t.matrix.forEach((t=>t.forEach((t=>{t._controller.setParent(this._controller)}))))}get state(){return this._model.getState()}setZIndex(t){this._model.setZIndex(t)}getParent(){return this._controller.getParent().host}}class G{constructor(){this._panelMap=r(null),this._panelCount=0,this._topZIndex=0}getCount(){return this._panelCount}getTopZIndex(){return this._topZIndex}add(t){const e=t.state.id;this._panelMap[e]=t,this._topZIndex=this._panelCount++,t.setZIndex(this._panelCount-1)}remove(t){const e=this._panelMap[t.state.id];e&&(this._topZIndex===e.state.zIndex&&this._topZIndex--,delete this._panelMap[t.state.id],this._panelCount--)}activate(t){if(t.state.zIndex!==this._topZIndex){for(const e in this._panelMap){const s=this._panelMap[e];s.state.zIndex>t.state.zIndex&&s.setZIndex(s.state.zIndex-1)}t.setZIndex(this._topZIndex)}}}class Z extends P{constructor(t){super(),this._state={panels:[],groups:[],stage:"body"},a(this._state,t)}deleteGroup(t){n(this._state,t),this.notify(new b,"deleteGroup",t)}getState(){return this._state}addPanel(t){this._state.panels.push(t),this.notify(new b(!1),"addPanel",t)}deletePanel(t){n(this._state.panels,t),this.notify(new b(!1),"deletePanel",t)}}class V extends y{deleteGroup(t){t._view.getElements().wrapper.remove()}create(t){this._$wrapper=$(t.stage).addClass(T.STAGE),t.panels.forEach((t=>this.addPanel(t))),t.groups.forEach((t=>this.addGroup(t))),this.bindEvents()}addPanel(t){this._$wrapper.append(t._view.getElements().wrapper)}addGroup(t){this._$wrapper.append(t._view.getElements().wrapper)}deletePanel(t){t._view.getElements().wrapper.remove()}bindEvents(){this._$wrapper.droppable({drop:(t,e)=>{const s=_.value.type;"tmpPanelFromTabDrag"===s?(_.setTask("tmpPanelFromTabDrop"),_.value.type="tmpPanelFromTabDrop",this.notify(new H,"tmpPanelFromTabDrop",e)):"splitPanelFromGroup"===s&&(_.setTask("splitPanelFromGroupDrop"),_.value.type="splitPanelFromGroupDrop",this.notify(new H,"splitPanelFromGroupDrop",e))}})}}class L{constructor(t){this.panelLayer=new G,this._model=new Z(t),this._view=new V,this._controller=new A(this._model,this._view,this),this._init()}deleteGroup(t){this._model.deleteGroup(t)}addPanel(t){this._model.addPanel(t)}deletePanel(t){this._model.deletePanel(t)}_init(){const t=this._model.getState();this._view.create(t),t.panels.forEach((t=>{t._controller.setParent(this._controller),this.panelLayer.add(t)})),t.groups.forEach((t=>{t._controller.setParent(this._controller),t.state.matrix.forEach((t=>t.forEach((t=>this.panelLayer.remove(t))))),this.panelLayer.add(t)}))}}
/**
   * A library for creating panels like PhotoShop.
   * 
   * Support ES5 browsers and above (ie10+, edge12+, chrome23+, safari6+, opeara15+)
   * For more compatibility details, see https://www.caniuse.com/es5
   * 
   * @author cary-mao
   * @license MIT
   * @copyright cary-mao 2021
   * @email 773099867@qq.com
   */
const F=function(t){const e={stage:(t=function(t={}){return a({panels:[],groups:[],stage:"body"},t)}(t)).stage};e.panels=t.panels.map((t=>R(t))),e.groups=t.groups.map((t=>function(t){const e=t.matrix.map((t=>t.map((t=>R(t)))));return new B({matrix:e,position:t.position,autoPos:t.autoPos})}(t)));return new L(e)};function R(t){const e=o(t);if(t.tabs){const s=t.tabs.filter((t=>t.actived));if(s.length)for(let t=1,e=s.length;t<e;t++)s[t].actived=!1;e.tabs=t.tabs.map((t=>new S(t)))}return new N(e)}return F.Panel=N,F.PanelStage=L,F.PanelGroup=B,F.logger=c,F}));
